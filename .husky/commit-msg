#!/bin/sh

# Get the commit message (passed as the first argument)
commit_msg_file="$1"

# Read the commit message
commit_msg=$(cat "$commit_msg_file")

# Regular expression for conventional commits
conventional_commit_regex='^(build|chore|ci|docs|feat|fix|perf|refactor|revert|style|test)(\([a-z \-]+\))?: .+'

# Check if commit message matches conventional commit format
if ! echo "$commit_msg" | head -1 | grep -qE "$conventional_commit_regex"; then
    echo "Error: Commit message does not follow conventional commit format."
    echo "Format: <type>(<scope>): <description>"
    echo ""
    echo "Valid types:"
    echo "  feat     - A new feature"
    echo "  fix      - A bug fix"
    echo "  docs     - Documentation only changes"
    echo "  style    - Changes not affecting code logic"
    echo "  refactor - Code refactoring"
    echo "  perf     - Performance improvements"
    echo "  test     - Adding or updating tests"
    echo "  build    - Build system changes"
    echo "  ci       - CI/CD changes"
    echo "  chore    - Maintenance tasks"
    echo "  revert   - Revert a previous commit"
    echo ""
    echo "Example: feat(cli): add version flag support"
    exit 1
fi

# Check commit message length
if [ ${#commit_msg} -gt 72 ]; then
    echo "Error: Commit message is too long (max 72 characters)"
    exit 1
fi

# All checks passed
exit 0
